<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploying FastAPI Docker container to AWS Lambda | Go, Python, AI, Devops, AWS, GCP, Cloud Architecture</title><meta name=keywords content="AWS,FastAPI,Lambda,Docker,Python"><meta name=description content="Deploy FastAPI (Python ASGI) to AWS Lambda with CodeDeploy"><meta name=author content="Eric Arellano"><link rel=canonical href=https://blog.ericarellano.tech/posts/aws_codedeploy/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.ericarellano.tech/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.ericarellano.tech/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.ericarellano.tech/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.ericarellano.tech/apple-touch-icon.png><link rel=mask-icon href=https://blog.ericarellano.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.ericarellano.tech/posts/aws_codedeploy/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://blog.ericarellano.tech/posts/aws_codedeploy/"><meta property="og:site_name" content="Go, Python, AI, Devops, AWS, GCP, Cloud Architecture"><meta property="og:title" content="Deploying FastAPI Docker container to AWS Lambda"><meta property="og:description" content="Deploy FastAPI (Python ASGI) to AWS Lambda with CodeDeploy"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-01T00:00:00-07:00"><meta property="article:modified_time" content="2022-10-01T00:00:00-07:00"><meta property="article:tag" content="AWS"><meta property="article:tag" content="FastAPI"><meta property="article:tag" content="Lambda"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Python"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying FastAPI Docker container to AWS Lambda"><meta name=twitter:description content="Deploy FastAPI (Python ASGI) to AWS Lambda with CodeDeploy"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"All Posts","item":"https://blog.ericarellano.tech/posts/"},{"@type":"ListItem","position":2,"name":"Deploying FastAPI Docker container to AWS Lambda","item":"https://blog.ericarellano.tech/posts/aws_codedeploy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying FastAPI Docker container to AWS Lambda","name":"Deploying FastAPI Docker container to AWS Lambda","description":"Deploy FastAPI (Python ASGI) to AWS Lambda with CodeDeploy","keywords":["AWS","FastAPI","Lambda","Docker","Python"],"articleBody":"Part 1: Deploying FastAPI app to AWS Lambda with Docker image This will show how to build a Docker container that can be run by AWS Lambda from the Elastic Container Registry.\nThe steps to follow on AWS are currently manual - via the AWS Console and the ECR provided Docker commands to upload images.\nIn future release, we will automate this release cycle using CodeDeploy, or possibly another AWS service if that turns out to be a better fit (CodePipeline? CloudFormation?)\nDeploying FastAPI to AWS Lambda Lambda allows multiple methods to provide the software artifacts to be executed as a Lambda Function. For a Python FastAPI app, the primary choices are a zip file and a Docker container image.\nTo deploy via zip file, follow the excellent instructions from Simon Willison at asgi-mangum To summarize, this method uses the wrapper library Mangum to translate between AWS Lambda’s (event, context) and ASGI’s standard HTTP interface.\nAWS Lambda Runtime Interface helper Amazon provides the awslambdaric helper library, or runtime interface client, to allow a Docker container to act as Lambda event receiver. This library can be easily added to Dockerfile and will work with Python 3.10, although not yet released on official AWS images. For the full dockerfile logic please refer to the AWS docs on PyPi. These also provide a multi-stage build to save image space.\nFROM python:3.10 RUN apt-get update \u0026\u0026 \\ apt-get install -y \\ g++ \\ make \\ cmake \\ unzip \\ libcurl4-openssl-dev RUN pip install \\ --target ${FUNCTION_DIR} \\ awslambdaric In layman’s terms a Docker container provides an executable command interface (or none for background services) via the CMD and ENTRYPOINT directives. Lambda Functions can also overwrite these if needed.\nThe CMD in Docker tells whomever is “calling” the Docker container what code will actually run and with which parameters. The caller can then modify these, for example to change a default path, timeout or other configuration value. Usually, in Kubernetes for example, this is defined during engineering and seldom modified later in the deployment cycle.\nKubernetes also allows the Docker command and entrypoint to be overridden, confusingly, with it’s own Command and Args specification While confusing, both sets of directives are useful to allow custom, zonal/regional or otherwise different deployments from the same docker image, specifying values from the local execution context or infrastructure, or even date.\nLambda Entrypoint and CMD For a Lambda function, the container should be instructed to hand control of it’s output to the runtime interface client as follows:\nENTRYPOINT [ \"python\", \"-m\", \"awslambdaric\" ] CMD [ \"app.module.handler\" ] Assuming that we have a file structure with python package “app” and a module “module” which provides the handler function (more on this soon!)\nfastapi_lambda_app \u003e app \u003e module.py module.py:\ndef handler(): return \"Lambada Oh\" All set, we can now upload our Docker image to the Amazon Elastic Container Registry for use in a Lambda Function.\nHowever, this docker image won’t know what to do when Lambda sends it’s (event, context) information, not yet.\nMangum, the Python ASGI Lambda hero To deploy FastAPI, or any ASGI compliant Python code via AWS Lambda, all that is required is to wrapp the ASGI application with [Mangum](https://mangum. io)\nRevised module.py:\nimport fastapi from mangum import Mangum app = fastapi.FastAPI(exception_handlers=home.exception_handlers) ... FastAPI application code and paths... ... handler = Mangum(app) Notice, there is no call to uvicorn or any other ASGI gateway library since we just want a function that Lambda can call.\nBuild Docker image and upload to ECR Once properly built and tested locally, we can upload the Lambda-ready image to ECR. This requires an existing ECR repository and appropriate AWS permissions.\ndocker build -t my_app . docker tag my_app:latest .dkr.ecr.us-east-1.amazonaws.com/my_app:latest docker push .dkr.ecr.us-east-1.amazonaws.com/my_app:latest AWS Lambda Function Link A little known feature of AWS Lambda Functions is that they can have their own URL, without the need for a Load Balancer or API Gateway to route requests into the function. This is very useful for simple website apps such as a FastAPI developer site, or any endpoint that doesn’t require heavy lifting and processing of requests.\nThe Lambda Function link can be protected by IAM, or open to the public. This URL can then be used as the CNAM in your preferred domain management console, to route actual human users in!\nPart II: Setup CodeDeploy for AWS Lambda automation? As mentioned in part I, we might end up using CodePipeline or another service to automate our FastAPI containerized app deployments to AWS Lambda function. However, here is the setup for CodeDeploy in case it’s needed.\nDeploy User for automation and DevOps responsible for CI/CD Create an IAM group and deploy user account with the following roles and without AWS Console login access. So this user should only have an Access Key and Access Secret, but no Password. Additionally, if using SSH for CodeCommit create an ssh key for user with:\nssh-keygen\nThen, upload the contents of public key file ending with .pub to the deploy user SSH public keys. Reference:\nsetting-up-ssh-unixes.html\nDeploy User roles and permissions In a production scenario, the Deploy User should only have required Read access to Repos, S3, etc. For testing, allowing full access speeds up development but should be restricted later for security.\nAWSCodeCommitFullAccess AmazonS3FullAccess AWSCodeDeployFullAccess AWSCodeDeployRoleForLambda AWSLambdaRole This IAM user will be used to manage code repositories, create CodeDeploy objects such as Application, Deployment-Groups and Deployments.\nCodeDeploy Service Role To run the actual Lambda functions and put the application into production, AWS Code Deploy requires a separate service-associated account. Create a CodeDeployServiceRole which the AWS service will use to run. This will be associated to the deployment-group upon creation.\nIAM Pass Role Policy for Deploy User Create the special IAM policy and assign it to the deploy user account to create the Deployment Group and “pass” the CodeDeploy service account permission to execute on it’s behalf.\nCreate Policy to allow deploy user IAM-PassRole\naws command to create deployment-group aws deploy create-deployment-group --application-name --deployment-group-name \u003e \\ --service-role-arn arn:aws:iam:::role/CodeDeployServiceRole { \"deploymentGroupId\": \"\" } ","wordCount":"1005","inLanguage":"en","datePublished":"2022-10-01T00:00:00-07:00","dateModified":"2022-10-01T00:00:00-07:00","author":{"@type":"Person","name":"Eric Arellano"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.ericarellano.tech/posts/aws_codedeploy/"},"publisher":{"@type":"Organization","name":"Go, Python, AI, Devops, AWS, GCP, Cloud Architecture","logo":{"@type":"ImageObject","url":"https://blog.ericarellano.tech/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.ericarellano.tech/ accesskey=h title="Go, Python, AI, Devops, AWS, GCP, Cloud Architecture (Alt + H)">Go, Python, AI, Devops, AWS, GCP, Cloud Architecture</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.ericarellano.tech/posts title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Deploying FastAPI Docker container to AWS Lambda</h1><div class=post-description>Deploy FastAPI (Python ASGI) to AWS Lambda with CodeDeploy</div><div class=post-meta><span title='2022-10-01 00:00:00 -0700 PDT'>October 1, 2022</span>&nbsp;·&nbsp;<span>Eric Arellano</span></div></header><div class=post-content><h1 id=part-1-deploying-fastapi-app-to-aws-lambda-with-docker-image>Part 1: Deploying FastAPI app to AWS Lambda with Docker image<a hidden class=anchor aria-hidden=true href=#part-1-deploying-fastapi-app-to-aws-lambda-with-docker-image>#</a></h1><p><img alt="Create AWS Lambda Function from Docker Image" loading=lazy src=/images/aws_create_lambda.png></p><p>This will show how to build a Docker container that can be run by AWS Lambda from the Elastic Container Registry.<br>The steps to follow on AWS are currently manual - via the AWS Console and the ECR provided Docker commands to upload
images.</p><p>In future release, we will automate this release cycle using CodeDeploy, or possibly another AWS service if that turns
out to be a better fit (CodePipeline? CloudFormation?)</p><h2 id=deploying-fastapi-to-aws-lambda>Deploying FastAPI to AWS Lambda<a hidden class=anchor aria-hidden=true href=#deploying-fastapi-to-aws-lambda>#</a></h2><p>Lambda allows multiple methods to provide the software artifacts to be executed as a Lambda Function. For a Python
FastAPI app, the primary choices are a zip file and a Docker container image.</p><p>To deploy via zip file, follow the excellent instructions from Simon Willison at <a href=https://til.simonwillison.net/awslambda/asgi-mangum>asgi-mangum</a>
To summarize, this method uses the wrapper library <a href=https://mangum.io>Mangum</a> to translate between AWS Lambda&rsquo;s<br><em>(event, context)</em> and ASGI&rsquo;s standard HTTP interface.</p><h3 id=aws-lambda-runtime-interface-helper>AWS Lambda Runtime Interface helper<a hidden class=anchor aria-hidden=true href=#aws-lambda-runtime-interface-helper>#</a></h3><p>Amazon provides the <a href=https://pypi.org/project/awslambdaric/>awslambdaric</a> helper library, or runtime interface
client, to allow a Docker container to act as Lambda event receiver. This library can be easily added to Dockerfile
and will work with Python 3.10, although not yet released on official AWS images. For the full dockerfile logic
please refer to the AWS docs on PyPi. These also provide a multi-stage build to save image space.</p><pre><code>FROM python:3.10
RUN apt-get update &amp;&amp; \
apt-get install -y \
g++ \
make \
cmake \
unzip \
libcurl4-openssl-dev

RUN pip install \
--target ${FUNCTION_DIR} \
    awslambdaric
</code></pre><p>In layman&rsquo;s terms a Docker container provides an executable command interface (or none for background services) via
the <a href=https://docs.docker.com/engine/reference/builder/>CMD and ENTRYPOINT</a> directives. Lambda Functions can also
overwrite these if needed.</p><p>The CMD in Docker tells whomever is &ldquo;calling&rdquo; the Docker container what code will
actually run and with which parameters. The caller can then modify these, for example to change a default path,
timeout or other configuration value. Usually, in Kubernetes for example, this is defined during engineering and
seldom modified later in the deployment cycle.</p><p>Kubernetes also allows the Docker command and entrypoint to be overridden, confusingly, with it&rsquo;s own
Command and Args <a href=https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/>specification</a>
While confusing, both sets of directives are useful to allow custom, zonal/regional or otherwise different deployments
from the same docker image, specifying values from the local execution context or infrastructure, or even date.</p><h4 id=lambda-entrypoint-and-cmd>Lambda Entrypoint and CMD<a hidden class=anchor aria-hidden=true href=#lambda-entrypoint-and-cmd>#</a></h4><p>For a Lambda function, the container should be instructed to hand control of it&rsquo;s output to the runtime interface
client as follows:</p><pre><code> ENTRYPOINT [ &quot;python&quot;, &quot;-m&quot;, &quot;awslambdaric&quot; ]
 CMD [ &quot;app.module.handler&quot; ]
</code></pre><p>Assuming that we have a file structure with python package &ldquo;app&rdquo; and a module &ldquo;module&rdquo; which provides the handler
function (more on this soon!)</p><pre><code> fastapi_lambda_app
   &gt; app
     &gt; module.py
</code></pre><p>module.py:</p><pre><code> def handler():
    return &quot;Lambada Oh&quot;
</code></pre><p>All set, we can now upload our Docker image to the Amazon Elastic Container Registry for use in a Lambda Function.</p><p><img alt="Create AWS Lambda Function from Docker Image" loading=lazy src=/images/aws_create_lambda.png></p><p>However, this docker image won&rsquo;t know what to do when Lambda sends it&rsquo;s <em>(event, context)</em> information, not yet.</p><h3 id=mangum-the-python-asgi-lambda-hero>Mangum, the Python ASGI Lambda hero<a hidden class=anchor aria-hidden=true href=#mangum-the-python-asgi-lambda-hero>#</a></h3><p>To deploy FastAPI, or any ASGI compliant Python code via AWS Lambda, all that is required is to wrapp the ASGI
application with [Mangum](https://mangum.
io)</p><p>Revised module.py:</p><pre><code> import fastapi
 from mangum import Mangum
 app = fastapi.FastAPI(exception_handlers=home.exception_handlers)
  
 ...
 FastAPI application code and paths...
 ...

 handler = Mangum(app)
</code></pre><p>Notice, there is no call to uvicorn or any other ASGI gateway library since we just want a function that Lambda can
call.</p><h3 id=build-docker-image-and-upload-to-ecr>Build Docker image and upload to ECR<a hidden class=anchor aria-hidden=true href=#build-docker-image-and-upload-to-ecr>#</a></h3><p>Once properly built and tested locally, we can upload the Lambda-ready image to ECR. This requires an existing ECR
repository and appropriate AWS permissions.</p><pre><code>docker build -t my_app .
docker tag my_app:latest &lt;aws_account&gt;.dkr.ecr.us-east-1.amazonaws.com/my_app:latest
docker push &lt;aws_account&gt;.dkr.ecr.us-east-1.amazonaws.com/my_app:latest
</code></pre><h3 id=aws-lambda-function-link>AWS Lambda Function Link<a hidden class=anchor aria-hidden=true href=#aws-lambda-function-link>#</a></h3><p>A little known feature of AWS Lambda Functions is that they can have their own URL, without the need for a Load
Balancer or API Gateway to route requests into the function. This is very useful for simple website apps such as a
FastAPI developer site, or any endpoint that doesn&rsquo;t require heavy lifting and processing of requests.</p><p><img alt=lambda_function_link loading=lazy src=/images/aws_lambda_url.png></p><p>The Lambda Function link can be protected by IAM, or open to the public. This URL can then be used as the CNAM in
your preferred domain management console, to route actual human users in!</p><hr><h2 id=part-ii-setup-codedeploy-for-aws-lambda-automation>Part II: Setup CodeDeploy for AWS Lambda automation?<a hidden class=anchor aria-hidden=true href=#part-ii-setup-codedeploy-for-aws-lambda-automation>#</a></h2><p>As mentioned in part I, we might end up using CodePipeline or another service to automate our FastAPI containerized
app deployments to AWS Lambda function. However, here is the setup for CodeDeploy in case it&rsquo;s needed.</p><h3 id=deploy-user-for-automation-and-devops-responsible-for-cicd>Deploy User for automation and DevOps responsible for CI/CD<a hidden class=anchor aria-hidden=true href=#deploy-user-for-automation-and-devops-responsible-for-cicd>#</a></h3><ol><li><p>Create an IAM group and deploy user account with the following roles and <em>without</em> AWS Console login access. So this
user should only have an Access Key and Access Secret, but no Password. Additionally, if using SSH for CodeCommit
create an ssh key for user with:</p><p>ssh-keygen</p></li></ol><p>Then, upload the contents of public key file ending with &lt;key_name>.pub to the deploy user SSH public keys. Reference:<br><a href=https://docs.aws.amazon.com/codecommit/latest/userguide/setting-up-ssh-unixes.html>setting-up-ssh-unixes.html</a></p><h4 id=deploy-user-roles-and-permissions>Deploy User roles and permissions<a hidden class=anchor aria-hidden=true href=#deploy-user-roles-and-permissions>#</a></h4><p>In a production scenario, the Deploy User should only have required Read access to Repos, S3, etc. For testing,
allowing full access speeds up development but should be restricted later for security.</p><ul><li>AWSCodeCommitFullAccess</li><li>AmazonS3FullAccess</li><li>AWSCodeDeployFullAccess</li><li>AWSCodeDeployRoleForLambda</li><li>AWSLambdaRole</li></ul><p>This IAM user will be used to manage code repositories, create CodeDeploy objects such as Application,
Deployment-Groups and Deployments.</p><hr><h3 id=codedeploy-service-role>CodeDeploy Service Role<a hidden class=anchor aria-hidden=true href=#codedeploy-service-role>#</a></h3><p><img alt=Service_Role loading=lazy src=/images/code_deploy_service_role.png></p><p>To run the actual Lambda functions and put the application into production, AWS Code Deploy requires a separate
service-associated account. Create a <a href=https://docs.aws.amazon.com/codedeploy/latest/userguide/getting-started-create-service-role.html#getting-started-get-service-role-cli>CodeDeployServiceRole</a> which the AWS service will use to run. This will be
associated to the deployment-group upon creation.</p><h3 id=iam-pass-role-policy-for-deploy-user>IAM Pass Role Policy for Deploy User<a hidden class=anchor aria-hidden=true href=#iam-pass-role-policy-for-deploy-user>#</a></h3><p>Create the special IAM policy and assign it to the deploy user account to create the Deployment Group and &ldquo;pass&rdquo; the
CodeDeploy service account permission to execute on it&rsquo;s behalf.</p><p><img alt=IAM_Pass_Role_Policy loading=lazy src=/images/codedeploy_pass_role_policy.png></p><p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html>Create Policy to allow deploy user IAM-PassRole</a></p><h4 id=aws-command-to-create-deployment-group>aws command to create deployment-group<a hidden class=anchor aria-hidden=true href=#aws-command-to-create-deployment-group>#</a></h4><pre><code> aws deploy create-deployment-group --application-name &lt;name&gt; --deployment-group-name &lt;deployments_name&gt;&gt; \
                                     --service-role-arn arn:aws:iam::&lt;AWS account&gt;:role/CodeDeployServiceRole

 {
   &quot;deploymentGroupId&quot;: &quot;&lt;id&gt;&quot;
  }
</code></pre><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.ericarellano.tech/tags/aws/>AWS</a></li><li><a href=https://blog.ericarellano.tech/tags/fastapi/>FastAPI</a></li><li><a href=https://blog.ericarellano.tech/tags/lambda/>Lambda</a></li><li><a href=https://blog.ericarellano.tech/tags/docker/>Docker</a></li><li><a href=https://blog.ericarellano.tech/tags/python/>Python</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://blog.ericarellano.tech/>Go, Python, AI, Devops, AWS, GCP, Cloud Architecture</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>