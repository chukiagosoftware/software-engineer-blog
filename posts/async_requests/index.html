<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Descargas asíncronas con Aiohttp | Async file download | Go, Python, AI, Devops, AWS, GCP, Cloud Architecture</title><meta name=keywords content="Python,Asyncio,Emoji,requests,aiohttp"><meta name=description content="Download Github Emojis locally

En Emojis de Github para Pelican con Markdown armamos los hermosos íconos que
se pueden ver por este blog. Bueno, en realidad bajamos el archivo json de Github con el diccionarios
#!python
{ _short_name_ : _http_url }

y utilizamos los enlaces para armar tags img. Poco a poco hemos mejorado algunas cosas, como regualr el tamaño de
los íconos 64x64 con CSS.
Para descargar los 1793 emojis de GitHub 

:copyright:
  la operación toma mucho tiempo para tan solo 9.1M: como 15
minutos 

:stopwatch:
"><meta name=author content="Eric Arellano"><link rel=canonical href=https://blog.ericarellano.tech/posts/async_requests/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.ericarellano.tech/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.ericarellano.tech/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.ericarellano.tech/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.ericarellano.tech/apple-touch-icon.png><link rel=mask-icon href=https://blog.ericarellano.tech/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.ericarellano.tech/posts/async_requests/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://blog.ericarellano.tech/posts/async_requests/"><meta property="og:site_name" content="Go, Python, AI, Devops, AWS, GCP, Cloud Architecture"><meta property="og:title" content="Descargas asíncronas con Aiohttp | Async file download"><meta property="og:description" content="Download Github Emojis locally En Emojis de Github para Pelican con Markdown armamos los hermosos íconos que se pueden ver por este blog. Bueno, en realidad bajamos el archivo json de Github con el diccionarios
#!python { _short_name_ : _http_url } y utilizamos los enlaces para armar tags img. Poco a poco hemos mejorado algunas cosas, como regualr el tamaño de los íconos 64x64 con CSS.
Para descargar los 1793 emojis de GitHub :copyright: la operación toma mucho tiempo para tan solo 9.1M: como 15 minutos :stopwatch: "><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-01T00:00:00-08:00"><meta property="article:modified_time" content="2020-12-01T00:00:00-08:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Asyncio"><meta property="article:tag" content="Emoji"><meta property="article:tag" content="Requests"><meta property="article:tag" content="Aiohttp"><meta name=twitter:card content="summary"><meta name=twitter:title content="Descargas asíncronas con Aiohttp | Async file download"><meta name=twitter:description content="Download Github Emojis locally

En Emojis de Github para Pelican con Markdown armamos los hermosos íconos que
se pueden ver por este blog. Bueno, en realidad bajamos el archivo json de Github con el diccionarios
#!python
{ _short_name_ : _http_url }

y utilizamos los enlaces para armar tags img. Poco a poco hemos mejorado algunas cosas, como regualr el tamaño de
los íconos 64x64 con CSS.
Para descargar los 1793 emojis de GitHub 

:copyright:
  la operación toma mucho tiempo para tan solo 9.1M: como 15
minutos 

:stopwatch:
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"All Posts","item":"https://blog.ericarellano.tech/posts/"},{"@type":"ListItem","position":2,"name":"Descargas asíncronas con Aiohttp | Async file download","item":"https://blog.ericarellano.tech/posts/async_requests/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Descargas asíncronas con Aiohttp | Async file download","name":"Descargas asíncronas con Aiohttp | Async file download","description":"Download Github Emojis locally En Emojis de Github para Pelican con Markdown armamos los hermosos íconos que se pueden ver por este blog. Bueno, en realidad bajamos el archivo json de Github con el diccionarios\n#!python { _short_name_ : _http_url } y utilizamos los enlaces para armar tags img. Poco a poco hemos mejorado algunas cosas, como regualr el tamaño de los íconos 64x64 con CSS.\nPara descargar los 1793 emojis de GitHub :copyright: la operación toma mucho tiempo para tan solo 9.1M: como 15 minutos :stopwatch: ","keywords":["Python","Asyncio","Emoji","requests","aiohttp"],"articleBody":"Download Github Emojis locally En Emojis de Github para Pelican con Markdown armamos los hermosos íconos que se pueden ver por este blog. Bueno, en realidad bajamos el archivo json de Github con el diccionarios\n#!python { _short_name_ : _http_url } y utilizamos los enlaces para armar tags img. Poco a poco hemos mejorado algunas cosas, como regualr el tamaño de los íconos 64x64 con CSS.\nPara descargar los 1793 emojis de GitHub :copyright: la operación toma mucho tiempo para tan solo 9.1M: como 15 minutos :stopwatch: En realidad es solamente esperar el round trip time entre nosotros y github.com 1800 veces, lo cual es una aplicación perfecta para IO mediante Async.\nPodríamos utilizar threading.Thread pero la idea es mirar hacia adelante con optimismo y darle con Async.\nA veces, un diff vale mil palabras y esperemos que esta es una de esas veces.\nComo se puede ver, es fácil añadir un poco de concurrencia async a un sencillo código en Python con Async y aiohttp. :godmode: Ahorramos valiosos minutos, que en una aplicación compleja pueden ser importantes.\nThe code The good old Requests method: @staticmethod def load_from_github(): try: resp = requests.get(SOURCE) payload = resp.content data = json.loads((payload.decode('utf-8'))) return GheEmoji(emoji=data) except Exception as e: print(e) Quick and dirty aiohttp client session and write bytes @staticmethod async def get_bytes(url: str) -\u003e bytes: async with aiohttp.ClientSession() as sesh: async with sesh.get(url) as payload: data = await payload.read() return data @staticmethod async def write_bytes(path: str, data: bytes) -\u003e bool: try: with Path(f\"{SAVE_PATH}{path}.png\").open('xb') as file_name: file_name.write(data) except FileExistsError as failed: print(failed) return @staticmethod async def fetch_task(tag: str, url: str): file = url.split('/')[-1] content = await GheEmoji.get_bytes(url) await GheEmoji.write_bytes(tag, content) async def download(self): tasks = [] for tag, url in self.getConfig('emoji').items(): tasks.append(self.fetch_task(tag, url)) await asyncio.wait(tasks) Running the test t0 = datetime.now() # single Get, just uses Requests m = GheEmoji.load_from_github() asyncio.run(m.download()) dt = datetime.now() - t0 print(f\"This took {dt} to run\") ","wordCount":"316","inLanguage":"en","datePublished":"2020-12-01T00:00:00-08:00","dateModified":"2020-12-01T00:00:00-08:00","author":{"@type":"Person","name":"Eric Arellano"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.ericarellano.tech/posts/async_requests/"},"publisher":{"@type":"Organization","name":"Go, Python, AI, Devops, AWS, GCP, Cloud Architecture","logo":{"@type":"ImageObject","url":"https://blog.ericarellano.tech/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.ericarellano.tech/ accesskey=h title="Go, Python, AI, Devops, AWS, GCP, Cloud Architecture (Alt + H)">Go, Python, AI, Devops, AWS, GCP, Cloud Architecture</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.ericarellano.tech/posts title=Posts><span>Posts</span></a></li><li><a href=https://blog.ericarellano.tech/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Descargas asíncronas con Aiohttp | Async file download</h1><div class=post-meta><span title='2020-12-01 00:00:00 -0800 PST'>December 1, 2020</span>&nbsp;·&nbsp;<span>Eric Arellano</span></div></header><div class=post-content><h3 id=download-github-emojis-locally>Download Github Emojis locally<a hidden class=anchor aria-hidden=true href=#download-github-emojis-locally>#</a></h3><p><img alt=diff loading=lazy src=/images/diff.png></p><p>En <a href=https://blog.ericarellano.tech/posts/pelican_github_emojis/>Emojis de Github para Pelican con Markdown</a> armamos los hermosos íconos que
se pueden ver por este blog. Bueno, en realidad bajamos el archivo json de Github con el diccionarios</p><pre><code>#!python
{ _short_name_ : _http_url }
</code></pre><p>y utilizamos los enlaces para armar tags <em>img</em>. Poco a poco hemos mejorado algunas cosas, como regualr el tamaño de
los íconos 64x64 con CSS.</p><p>Para descargar los 1793 emojis de GitHub
:copyright:
la operación toma mucho tiempo para tan solo 9.1M: como 15
minutos
:stopwatch:</p><p>En realidad es solamente esperar el round trip time entre nosotros y github.com 1800 veces, lo cual es una
aplicación perfecta para IO mediante Async.</p><p><img alt=sync_download loading=lazy src=/images/sync.png></p><hr><p>Podríamos utilizar <em>threading.Thread</em> pero la idea es mirar hacia adelante con optimismo y darle con Async.</p><p>A veces, un diff vale mil palabras y esperemos que esta es una de esas veces.</p><p>Como se puede ver, es fácil añadir un poco de concurrencia async a un sencillo código en Python con
Async y aiohttp.
:godmode:
Ahorramos valiosos minutos, que en una aplicación compleja pueden ser importantes.</p><p><img alt=async_download loading=lazy src=/images/async_download.png></p><hr><h3 id=the-code>The code<a hidden class=anchor aria-hidden=true href=#the-code>#</a></h3><h4 id=the-good-old-requests-method>The good old Requests method:<a hidden class=anchor aria-hidden=true href=#the-good-old-requests-method>#</a></h4><pre><code>@staticmethod
def load_from_github():
    try:
        resp = requests.get(SOURCE)
        payload = resp.content
        data = json.loads((payload.decode('utf-8')))
        return GheEmoji(emoji=data)
    except Exception as e:
        print(e)
</code></pre><hr><h4 id=quick-and-dirty-aiohttp-client-session-and-write-bytes>Quick and dirty aiohttp client session and write bytes<a hidden class=anchor aria-hidden=true href=#quick-and-dirty-aiohttp-client-session-and-write-bytes>#</a></h4><pre><code>@staticmethod
async def get_bytes(url: str) -&gt; bytes:
    async with aiohttp.ClientSession() as sesh:
        async with sesh.get(url) as payload:
            data = await payload.read()
            return data

@staticmethod
async def write_bytes(path: str, data: bytes) -&gt; bool:
    try:
        with Path(f&quot;{SAVE_PATH}{path}.png&quot;).open('xb') as file_name:
            file_name.write(data)
    except FileExistsError as failed:
        print(failed)
        return

@staticmethod
async def fetch_task(tag: str, url: str):
    file = url.split('/')[-1]
    content = await GheEmoji.get_bytes(url)
    await GheEmoji.write_bytes(tag, content)

async def download(self):
    tasks = []
    for tag, url in self.getConfig('emoji').items():
        tasks.append(self.fetch_task(tag, url))
    await asyncio.wait(tasks)
</code></pre><hr><h4 id=running-the-test>Running the test<a hidden class=anchor aria-hidden=true href=#running-the-test>#</a></h4><pre><code>t0 = datetime.now()
# single Get, just uses Requests
m = GheEmoji.load_from_github() 

asyncio.run(m.download())
dt = datetime.now() - t0
print(f&quot;This took {dt} to run&quot;)
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.ericarellano.tech/tags/python/>Python</a></li><li><a href=https://blog.ericarellano.tech/tags/asyncio/>Asyncio</a></li><li><a href=https://blog.ericarellano.tech/tags/emoji/>Emoji</a></li><li><a href=https://blog.ericarellano.tech/tags/requests/>Requests</a></li><li><a href=https://blog.ericarellano.tech/tags/aiohttp/>Aiohttp</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://blog.ericarellano.tech/>Go, Python, AI, Devops, AWS, GCP, Cloud Architecture</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>